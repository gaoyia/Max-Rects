<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>MaxRects 算法演示</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .controls {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    button {
      padding: 8px 12px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #0069d9;
    }
    .container {
      width: 1000px;
      height: 1000px;
      position: relative;
      background: #f5f5f5;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.5);
      margin-top: 20px;
    }
    .rect {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.5);
      cursor: move;
    }
    .free-rect {
      position: absolute;
      background-color: #ccc;
      border: 1px dashed #666;
      pointer-events: none;
      opacity: 0.7;
    }
    .donate-section {
      margin-top: 30px;
      text-align: center;
    }
    .donate-section h2 {
      color: #333;
      margin-bottom: 15px;
    }
    .donate-image {
      max-width: 30%;
      height: auto;
      border: 1px solid #ddd;
      border-radius: 5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>MaxRects 算法演示</h1>
  <div class="controls">
    <button id="add-small">添加小矩形 (50×50)</button>
    <button id="add-medium">添加中矩形 (100×100)</button>
    <button id="add-large">添加大矩形 (200×150)</button>
    <button id="add-random">添加随机矩形</button>
    <button id="clear">清空所有</button>
    <button id="remove">删除最后一个</button>
    <button id="toggle-free">显示/隐藏空闲区域</button>
  </div>
  <div class="container" id="container"></div>

  <div class="donate-section">
    <h2>支持项目发展</h2>
    <p>如果您觉得这个项目对您有帮助，欢迎扫码捐赠支持：</p>
    <img src="donate.jpg" alt="捐赠二维码" class="donate-image">
  </div>

  <script type="module">
    import { MaxRectsPacker } from './dist/index.mjs';
    
    const container = document.getElementById('container');
    const colors = ['#FF5252', '#FF4081', '#E040FB', '#7C4DFF', '#536DFE', '#448AFF', '#40C4FF', '#18FFFF', '#64FFDA', '#69F0AE', '#B2FF59', '#EEFF41', '#FFFF00', '#FFD740', '#FFAB40', '#FF6E40'];
    let rects = [];
    let freeRects = [];
    let showFreeRects = false;
    let zIndex = 1;
    const packer = new MaxRectsPacker(1000, 1000, 5);
    function addRect(width, height) {
      packer.add(width, height, { color: colors[Math.floor(Math.random() * colors.length)] });
      console.log(packer);
      const result = packer.pack();
      
      // 清除现有矩形
      rects.forEach(rect => container.removeChild(rect));
      rects = [];
      
      // 清除现有的free区域显示
      freeRects.forEach(rect => container.removeChild(rect));
      freeRects = [];
      
      // 重新渲染所有矩形
      result.packed.forEach(rect => {
        const div = document.createElement('div');
        div.className = 'rect';
        div.style.width = `${rect.w}px`;
        div.style.height = `${rect.h}px`;
        div.style.left = `${rect.x}px`;
        div.style.top = `${rect.y}px`;
        div.style.backgroundColor = rect.data.color;
        div.style.zIndex = zIndex++;
        div.textContent = `${rect.w}×${rect.h}`;
        container.appendChild(div);
        rects.push(div);
      });
      
      // 如果需要显示free区域
      if (showFreeRects) {
        packer.free.forEach(rect => {
          const div = document.createElement('div');
          div.className = 'free-rect';
          // 不考虑gap的free区域显示
          div.style.width = `${rect.w}px`;
          div.style.height = `${rect.h}px`;
          div.style.left = `${rect.x}px`;
          div.style.top = `${rect.y}px`;
          div.style.zIndex = zIndex++;
          container.appendChild(div);
          freeRects.push(div);
        });
      }
    }

    document.getElementById('add-small').addEventListener('click', () => addRect(50, 50));
    document.getElementById('add-medium').addEventListener('click', () => addRect(100, 100));
    document.getElementById('add-large').addEventListener('click', () => addRect(200, 150));
    document.getElementById('add-random').addEventListener('click', () => {
      const width = 50 + Math.floor(Math.random() * 200);
      const height = 50 + Math.floor(Math.random() * 200);
      addRect(width, height);
    });
    document.getElementById('clear').addEventListener('click', () => {
      rects.forEach(rect => container.removeChild(rect));
      rects = [];
      freeRects.forEach(rect => container.removeChild(rect));
      freeRects = [];
      packer.reset();
    });
    document.getElementById('remove').addEventListener('click', () => {
      if (rects.length > 0) {
        container.removeChild(rects.pop());
      }
    });
    
    document.getElementById('toggle-free').addEventListener('click', () => {
      showFreeRects = !showFreeRects;
      if (showFreeRects) {
        // 显示free区域
        packer.free.forEach(rect => {
          const div = document.createElement('div');
          div.className = 'free-rect';
          // 不考虑gap的free区域显示
          div.style.width = `${rect.w}px`;
          div.style.height = `${rect.h}px`;
          div.style.left = `${rect.x}px`;
          div.style.top = `${rect.y}px`;
          div.style.zIndex = zIndex++;
          container.appendChild(div);
          freeRects.push(div);
        });
      } else {
        // 隐藏free区域
        freeRects.forEach(rect => container.removeChild(rect));
        freeRects = [];
      }
    });

    // 添加拖拽功能
    container.addEventListener('mousedown', function(e) {
      const target = e.target.closest('.rect');
      if (!target) return;

      let isDragging = true;
      const startX = e.clientX;
      const startY = e.clientY;
      const rectX = parseInt(target.style.left) || 0;
      const rectY = parseInt(target.style.top) || 0;

      function moveRect(e) {
        if (!isDragging) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        
        const newX = Math.max(0, Math.min(container.clientWidth - target.offsetWidth, rectX + dx));
        const newY = Math.max(0, Math.min(container.clientHeight - target.offsetHeight, rectY + dy));
        
        target.style.left = `${newX}px`;
        target.style.top = `${newY}px`;
      }

      function stopDrag() {
        isDragging = false;
        document.removeEventListener('mousemove', moveRect);
        document.removeEventListener('mouseup', stopDrag);
      }

      document.addEventListener('mousemove', moveRect);
      document.addEventListener('mouseup', stopDrag);
    });
  </script>
</body>
</html>